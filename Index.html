<html>
	<head>
		<style type="text/css">
			.textBox {
				width: 700px;
			}
			.scrambledImage {
				width: 240px;
				height: 240px;
				background-color: #ccc;
				position: static;
			}
			.unscrambledImage {
				width: 240px;
				height: 240px;
				background-color: #fcc;
				position: relative;
				overflow: hidden;
			}

			.tile00 {
				width: 60px;
				height: 60px;
				background-color: #003;
				overflow: hidden;
				position: absolute;
				left: 0px;
				top: 0px;
			}
			.tile01 {
				width: 60px;
				height: 60px;
				background-color: #006;
				overflow: hidden;
				position: absolute;
				left: 60px;
				top: 0px;
			}
			.tile02 {
				width: 60px;
				height: 60px;
				background-color: #009;
				overflow: hidden;
				position: absolute;
				left: 120px;
				top: 0px;
			}
			.tile03 {
				width: 60px;
				height: 60px;
				background-color: #00c;
				overflow: hidden;
				position: absolute;
				left: 180px;
				top: 0px;
			}

			.tile10 {
				width: 60px;
				height: 60px;
				background-color: #030;
				overflow: hidden;
				position: absolute;
				top: 60px;
				left: 0px;
			}
			.tile11 {
				width: 60px;
				height: 60px;
				background-color: #060;
				overflow: hidden;
				position: absolute;
				top: 60px;
				left: 60px;
			}
			.tile12 {
				width: 60px;
				height: 60px;
				background-color: #090;
				overflow: hidden;
				position: absolute;
				top: 60px;
				left: 120px;
			}
			.tile13 {
				width: 60px;
				height: 60px;
				background-color: #0c0;
				overflow: hidden;
				position: absolute;
				top: 60px;
				left: 180px;
			}

			.tile20 {
				width: 60px;
				height: 60px;
				background-color: #300;
				overflow: hidden;
				position: absolute;
				top: 120px;
				left: 0px;
			}
			.tile21 {
				width: 60px;
				height: 60px;
				background-color: #600;
				overflow: hidden;
				position: absolute;
				top: 120px;
				left: 60px;
			}
			.tile22 {
				width: 60px;
				height: 60px;
				background-color: #900;
				overflow: hidden;
				position: absolute;
				top: 120px;
				left: 120px;
			}
			.tile23 {
				width: 60px;
				height: 60px;
				background-color: #c00;
				overflow: hidden;
				position: absolute;
				top: 120px;
				left: 180px;
			}

			.tile30 {
				width: 60px;
				height: 60px;
				background-color: #30c;
				overflow: hidden;
				position: absolute;
				top: 180px;
				left: 0px;
			}
			.tile31 {
				width: 60px;
				height: 60px;
				background-color: #60c;
				overflow: hidden;
				position: absolute;
				top: 180px;
				left: 60px;
			}
			.tile32 {
				width: 60px;
				height: 60px;
				background-color: #90c;
				overflow: hidden;
				position: absolute;
				top: 180px;
				left: 120px;
			}
			.tile33 {
				width: 60px;
				height: 60px;
				background-color: #c0c;
				overflow: hidden;
				position: absolute;
				top: 180px;
				left: 180px;
			}
			.freeFormCell {
				background-color: #99f;
			}

			/* ================================================== */
			/* Algorithm 0 */
			#image0x00 {
				position: absolute;
				top: -60px;
				left: 0px;
			}
			#image0x01 {
				position: absolute;
				top: -120px;
				left: -60px;
			}
			#image0x02 {
				position: absolute;
				top: -120px;
				left: -120px;
			}
			#image0x03 {
				position: absolute;
				top: -120px;
				left: -180px;
			}

			#image0x10 {
				position: absolute;
				top: -60px;
				left: -120px;
			}
			#image0x11 {
				position: absolute;
				top: -180px;
				left: -180px;
			}
			#image0x12 {
				position: absolute;
				top: 0px;
				left: -120px;
			}
			#image0x13 {
				position: absolute;
				top: -120px;
				left: 0px;
			}

			#image0x20 {
				position: absolute;
				top: -60px;
				left: -180px;
			}
			#image0x21 {
				position: absolute;
				top: 0px;
				left: -60px;
			}
			#image0x22 {
				position: absolute;
				top: -180px;
				left: 0px;
			}
			#image0x23 {
				position: absolute;
				top: -180px;
				left: -60px;
			}

			#image0x30 {
				position: absolute;
				top: -180px;
				left: -120px;
			}
			#image0x31 {
				position: absolute;
				top: -60px;
				left: -60px;
			}
			#image0x32 {
				position: absolute;
				top: 0px;
				left: -180px;
			}
			#image0x33 {
				position: absolute;
				top: 0px;
				left: 0px;
			}

			/* ================================================== */
			/* Algorithm 1 */
			#image1x00 {
				position: absolute;
				top: -120px;
				left: 0px;
			}
			#image1x01 {
				position: absolute;
				top: -180px;
				left: -120px;
			}
			#image1x02 {
				position: absolute;
				top: -180px;
				left: -180px;
			}
			#image1x03 {
				position: absolute;
				top: -60px;
				left: -120px;
			}

			#image1x10 {
				position: absolute;
				top: -180px;
				left: 0px;
			}
			#image1x11 {
				position: absolute;
				top: -60px;
				left: -60px;
			}
			#image1x12 {
				position: absolute;
				top: 0px;
				left: -180px;
			}
			#image1x13 {
				position: absolute;
				top: -120px;
				left: -60px;
			}

			#image1x20 {
				position: absolute;
				top: -120px;
				left: -120px;
			}
			#image1x21 {
				position: absolute;
				top: -60px;
				left: -180px;
			}
			#image1x22 {
				position: absolute;
				top: 0px;
				left: -60px;
			}
			#image1x23 {
				position: absolute;
				top: 0px;
				left: 0px;
			}

			#image1x30 {
				position: absolute;
				top: -180px;
				left: -60px;
			}
			#image1x31 {
				position: absolute;
				top: -60px;
				left: 0px;
			}
			#image1x32 {
				position: absolute;
				top: -120px;
				left: -180px;
			}
			#image1x33 {
				position: absolute;
				top: 0px;
				left: -120px;
			}

			/* ================================================== */
			/* Algorithm 2 */
			#image2x00 {
				position: absolute;
				/* 8: (2, 0) */
				top: -120px;
				left: 0px;
			}
			#image2x01 {
				position: absolute;
				/* 4: (1, 0) */
				top: -60px;
				left: 0px;
			}
			#image2x02 {
				position: absolute;
				/* 9: (2, 1) */
				top: -180px;
				left: -60px;
			}
			#image2x03 {
				position: absolute;
				top: -60px;
				left: -180px;
			}

			#image2x10 {
				position: absolute;
				top: -60px;
				left: -120px;
			}
			#image2x11 {
				position: absolute;
				top: -120px;
				left: -120px;
			}
			#image2x12 {
				position: absolute;
				top: -180px;
				left: -120px;
			}
			#image2x13 {
				position: absolute;
				top: -60px;
				left: -60px;
			}

			#image2x20 {
				position: absolute;
				top: 0px;
				left: -120px;
			}
			#image2x21 {
				position: absolute;
				top: -120px;
				left: -60px;
			}
			#image2x22 {
				position: absolute;
				top: 0px;
				left: 0px;
			}
			#image2x23 {
				position: absolute;
				top: 0px;
				left: -60px;
			}

			#image2x30 {
				position: absolute;
				top: -180px;
				left: -180px;
			}
			#image2x31 {
				position: absolute;
				top: 0px;
				left: -180px;
			}
			#image2x32 {
				position: absolute;
				top: -120px;
				left: -180px;
			}
			#image2x33 {
				position: absolute;
				top: -180px;
				left: 0px;
			}

			/* ================================================== */
			/* Algorithm 3 */
			#image3x00 {
				position: absolute;
				top: -120px;
				left: -180px;
			}
			#image3x01 {
				position: absolute;
				top: -60px;
				left: -180px;
			}
			#image3x02 {
				position: absolute;
				top: -60px;
				left: -60px;
			}
			#image3x03 {
				position: absolute;
				top: -180px;
				left: -120px;
			}

			#image3x10 {
				position: absolute;
				top: -180px;
				left: -60px;
			}
			#image3x11 {
				position: absolute;
				top: -60px;
				left: 0px;
			}
			#image3x12 {
				position: absolute;
				top: -180px;
				left: -180px;
			}
			#image3x13 {
				position: absolute;
				top: -180px;
				left: 0px;
			}

			#image3x20 {
				position: absolute;
				top: 0px;
				left: 0px;
			}
			#image3x21 {
				position: absolute;
				top: -120px;
				left: 0px;
			}
			#image3x22 {
				position: absolute;
				top: 0px;
				left: -180px;
			}
			#image3x23 {
				position: absolute;
				top: -60px;
				left: -120px;
			}

			#image3x30 {
				position: absolute;
				top: -120px;
				left: -120px;
			}
			#image3x31 {
				position: absolute;
				top: 0px;
				left: -60px;
			}
			#image3x32 {
				position: absolute;
				top: 0px;
				left: -120px;
			}
			#image3x33 {
				position: absolute;
				top: -120px;
				left: -60px;
			}
		</style>
		<script type="text/javascript" language="javascript">
			// Global variables
			var freeFormShuffleIndex = [];
			var previousImageId = null;

			// Set the freeFormShuffleIndex to its initial state (0-15)
			for (var i = 0; i < 16; i++) {
				freeFormShuffleIndex[i] = i;
			}

			/**
			 * Click handler for the tiles in the Free Form Shuffle grid.  
			 */
			function beginSwap(image) {
				var selectedId = image.id;
				var selectedIndex = getIndexFromId(selectedId);
				var previousIndex = -1;

				if (previousImageId) {
					// This is the second click: Time to swap!

					previousIndex = getIndexFromId(previousImageId);

					var oldIndex = freeFormShuffleIndex[previousIndex];
					freeFormShuffleIndex[previousIndex] = freeFormShuffleIndex[selectedIndex];
					freeFormShuffleIndex[selectedIndex] = oldIndex;

					// Redraw the Free Form Shuffle grid
					transformFreeForm();

					// Reset the previousImageId to null so we know we are not in swapping mode
					previousImageId = null;
				}
				else {
					// This is the first click
					previousImageId = selectedId;
				}
			}

			/**
			 * Redraws the Free Form Shuffle grid according to the mapping index.
			 */
			function transformFreeForm() {
				for (var i = 0; i < 4; i++) {
					for (var j = 0; j < 4; j++) {
						var img = getImage(4, i, j);

						var index = freeFormShuffleIndex[getIndexFromXY(i, j)];
						var top = getXOffset(index) + 'px';
						var left = getYOffset(index) + 'px';

						img.style.position = 'absolute';
						img.style.top = top;
						img.style.left = left;

						// console.log(i + 'x' + j + ' : (' + top + ' ' + left + ')');
					}
				}
			}

			/**
			 * Called when the document finishes loading.  This sets the focus to the textbox
			 * for easy debugging.
			 */
			function bodyLoad() {
				var textBox = document.getElementById('ImageUrlTextBox');
				textBox.focus();
			}

			/**
			 * Loads the image and applies it to all the appropriate elements.
			 */
			function doClick() {
				var imageUrl = document.getElementById('ImageUrlTextBox').value;
				var originalImage = document.getElementById('scrambledImageImg');

				// Set the original unaltered image
				originalImage.src = imageUrl;

				// Set the image src for all the images in all the grids.
				for (var i = 0; i < 5; i++) {
					for (var j = 0; j < 4; j++) {
						for (var k = 0; k < 4; k++) {
							var image = getImage(i, j, k);
							image.src = imageUrl;
						}
					}
				}

				// Redraw the Free Form Grid
				transformFreeForm();
			}

			/**
			 * Takes in the x, y and z
			 * example:
			 * 		getImage(0, 1, 2);		// returns element with id of "image0x12"
			 * 		getImage(1, 2, 3);		// returns element with id of "image0x13"
			 */
			function getImage(section, x, y) {
				return document.getElementById('image' + section +'x' + x + '' + y);
			}

			/**
			 * Takes in the image Id string and parses it to get the corresponding 1-dimensional
			 * index.
			 */
			function getIndexFromId(imageId) {
				var x = imageId.substring(7, 8);
				var y = imageId.substring(8, 9);
				var index = (4 * x) + (y * 1);
				return index;
			}

			/**
			 * Shifts the entire canvas up or down by the delta amount.  The delta should be 
			 * between -1 and +1.  A delta of 0 does nothing.
			 */
			function shiftX(delta) {
				if (delta !== -1 && delta !== 1) {
					return;
				}

				var tempValue;
				var i, j;

				if (delta === 1) {
					// Shift downward
					for (i = 0; i < 4; i++) {

						tempValue = freeFormShuffleIndex[getIndexFromXY(3, i)];
						freeFormShuffleIndex[getIndexFromXY(3, i)] = freeFormShuffleIndex[getIndexFromXY(2, i)];
						freeFormShuffleIndex[getIndexFromXY(2, i)] = freeFormShuffleIndex[getIndexFromXY(1, i)];
						freeFormShuffleIndex[getIndexFromXY(1, i)] = freeFormShuffleIndex[getIndexFromXY(0, i)];
						freeFormShuffleIndex[getIndexFromXY(0, i)] = tempValue;
					}
				} else if (delta === -1) {
					// Shift upward
					for (i = 0; i < 4; i++) {

						tempValue = freeFormShuffleIndex[getIndexFromXY(0, i)];
						freeFormShuffleIndex[getIndexFromXY(0, i)] = freeFormShuffleIndex[getIndexFromXY(1, i)];
						freeFormShuffleIndex[getIndexFromXY(1, i)] = freeFormShuffleIndex[getIndexFromXY(2, i)];
						freeFormShuffleIndex[getIndexFromXY(2, i)] = freeFormShuffleIndex[getIndexFromXY(3, i)];
						freeFormShuffleIndex[getIndexFromXY(3, i)] = tempValue;
					}
				}

				// Redraw the Free Form Grid
				transformFreeForm();
			}

			function shiftY(delta) {
				if (delta !== -1 && delta !== 1) {
					return;
				}

				var tempValue;
				var i, j;

				if (delta === 1) {
					// Shift right
					for (i = 0; i < 4; i++) {

						tempValue = freeFormShuffleIndex[getIndexFromXY(i, 3)];
						freeFormShuffleIndex[getIndexFromXY(i, 3)] = freeFormShuffleIndex[getIndexFromXY(i, 2)];
						freeFormShuffleIndex[getIndexFromXY(i, 2)] = freeFormShuffleIndex[getIndexFromXY(i, 1)];
						freeFormShuffleIndex[getIndexFromXY(i, 1)] = freeFormShuffleIndex[getIndexFromXY(i, 0)];
						freeFormShuffleIndex[getIndexFromXY(i, 0)] = tempValue;
					}
				} else if (delta === -1) {
					// Shift left
					for (i = 0; i < 4; i++) {

						tempValue = freeFormShuffleIndex[getIndexFromXY(i, 0)];
						freeFormShuffleIndex[getIndexFromXY(i, 0)] = freeFormShuffleIndex[getIndexFromXY(i, 1)];
						freeFormShuffleIndex[getIndexFromXY(i, 1)] = freeFormShuffleIndex[getIndexFromXY(i, 2)];
						freeFormShuffleIndex[getIndexFromXY(i, 2)] = freeFormShuffleIndex[getIndexFromXY(i, 3)];
						freeFormShuffleIndex[getIndexFromXY(i, 3)] = tempValue;
					}
				}

				// Redraw the Free Form Grid
				transformFreeForm();
			}

			/**
			 * Takes in x, y coordinates and returns the 1-dimensional index of the element.
			 * examples:
			 * 		getIndexFromXY(0, 0);	// returns 0
			 * 		getIndexFromXY(3, 3);	// returns 15
			 */
			function getIndexFromXY(x, y) {
				return (4 * x) + y;
			}

			/**
			 * Takes in the 1-dimensional index and returns the corresponding x coordinate
			 */
			function getXIndex(index) {
				return parseInt(index / 4);
			}

			/**
			 * Takes in the 1-dimensional index and returns the corresponding y coordinate
			 */
			function getYIndex(index) {
				return index % 4;
			}

			/**
			 * Takes in the 1-dimensional index and returns the vertical (x) pixel offset
			 */
			function getXOffset(index) {
				return -(getXIndex(index) * 60);
			}

			/**
			 * Takes in the 1-dimensional index and returns the horizontal (y) pixel offset
			 */
			function getYOffset(index) {
				return -(getYIndex(index) * 60);
			}
		</script>
	</head>
	<body onload="bodyLoad();">
		<form method="GET" action="#">
			<table>
				<tr>
					<td>
						&nbsp;
					</td>
					<td>
						&nbsp;
					</td>
				</tr>
				<tr>
					<td colspan="2">
						OKCupid: "Crazy Blind Date" Image Descrambler version 0.10
						<br /><br />
					</td>
				</tr>
				<tr>
					<td>
						&nbsp;
					</td>
					<td>
						Instructions:
						<ul>
							<li>Right-click the scrambled image</li>
							<li>Click "Copy Image URL"</li>
							<li>Paste the image in the Text Box below</li>
							<li>Click Go</li>
							<li>If the predetermined shuffle algorithms don't work, then use the "Free Form Shuffle" to 
								rearrange the picture by clicking on the tiles.</li>
							<li>Message the attractive ones</li>
						</ul>
					</td>
				</tr>
				<tr>
					<td>
						Image URL:
					</td>
					<td>
						<input
							type="text"
							id="ImageUrlTextBox"
							class="textBox"
							/>
					</td>
				</tr>
				<tr>
					<td>
						&nbsp;
					</td>
					<td>
						<input type="button" value="Go" onclick="doClick();" />
					</td>
				</tr>
			</table>
		</form>
		<table>
			<tr>
				<td>
					BEFORE:
					<br />
					<div id="scrambledImageDiv" class="scrambledImage" >
						<img
							id="scrambledImageImg" />
					</div>
				</td>
				<td>
					Algorithm 0 (7fffffff):
					<br />
					<div id="unscrambledImageDiv" class="unscrambledImage" >
						<div class="tile00"><img id="image0x00" /></div>
						<div class="tile01"><img id="image0x01" /></div>
						<div class="tile02"><img id="image0x02" /></div>
						<div class="tile03"><img id="image0x03" /></div>

						<div class="tile10"><img id="image0x10" /></div>
						<div class="tile11"><img id="image0x11" /></div>
						<div class="tile12"><img id="image0x12" /></div>
						<div class="tile13"><img id="image0x13" /></div>
						
						<div class="tile20"><img id="image0x20" /></div>
						<div class="tile21"><img id="image0x21" /></div>
						<div class="tile22"><img id="image0x22" /></div>
						<div class="tile23"><img id="image0x23" /></div>
						
						<div class="tile30"><img id="image0x30" /></div>
						<div class="tile31"><img id="image0x31" /></div>
						<div class="tile32"><img id="image0x32" /></div>
						<div class="tile33"><img id="image0x33" /></div>
					</div>
				</td>
				<td>
					Algorithm 1 (195745ba):
					<br />
					<div class="unscrambledImage" >
						<div class="tile00"><img id="image1x00" /></div>
						<div class="tile01"><img id="image1x01" /></div>
						<div class="tile02"><img id="image1x02" /></div>
						<div class="tile03"><img id="image1x03" /></div>

						<div class="tile10"><img id="image1x10" /></div>
						<div class="tile11"><img id="image1x11" /></div>
						<div class="tile12"><img id="image1x12" /></div>
						<div class="tile13"><img id="image1x13" /></div>
						
						<div class="tile20"><img id="image1x20" /></div>
						<div class="tile21"><img id="image1x21" /></div>
						<div class="tile22"><img id="image1x22" /></div>
						<div class="tile23"><img id="image1x23" /></div>
						
						<div class="tile30"><img id="image1x30" /></div>
						<div class="tile31"><img id="image1x31" /></div>
						<div class="tile32"><img id="image1x32" /></div>
						<div class="tile33"><img id="image1x33" /></div>
					</div>
				</td>
				<td class="freeFormCell">
					Free Form Shuffle:
					<br />
					<table>
						<tr>
							<td>
								&nbsp;
							</td>
							<td align="center">
								<input type="button" value="UP" style="width: 240px;" onclick="shiftX(-1);" />
							</td>
							<td>
								&nbsp;
							</td>
						</tr>
						<tr>
							<td>
								<input type="button" value="&laquo;" style="height: 240px;" onclick="shiftY(-1);" />
							</td>
							<td>
								<div class="unscrambledImage" >
									<div class="tile00"><img id="image4x00" onclick="beginSwap(this);" /></div>
									<div class="tile01"><img id="image4x01" onclick="beginSwap(this);" /></div>
									<div class="tile02"><img id="image4x02" onclick="beginSwap(this);" /></div>
									<div class="tile03"><img id="image4x03" onclick="beginSwap(this);" /></div>

									<div class="tile10"><img id="image4x10" onclick="beginSwap(this);" /></div>
									<div class="tile11"><img id="image4x11" onclick="beginSwap(this);" /></div>
									<div class="tile12"><img id="image4x12" onclick="beginSwap(this);" /></div>
									<div class="tile13"><img id="image4x13" onclick="beginSwap(this);" /></div>
									
									<div class="tile20"><img id="image4x20" onclick="beginSwap(this);" /></div>
									<div class="tile21"><img id="image4x21" onclick="beginSwap(this);" /></div>
									<div class="tile22"><img id="image4x22" onclick="beginSwap(this);" /></div>
									<div class="tile23"><img id="image4x23" onclick="beginSwap(this);" /></div>
									
									<div class="tile30"><img id="image4x30" onclick="beginSwap(this);" /></div>
									<div class="tile31"><img id="image4x31" onclick="beginSwap(this);" /></div>
									<div class="tile32"><img id="image4x32" onclick="beginSwap(this);" /></div>
									<div class="tile33"><img id="image4x33" onclick="beginSwap(this);" /></div>
								</div>
							</td>
							<td>
								<input type="button" value="&raquo;" style="height: 240px;" onclick="shiftY(1);" />
							</td>
						</tr>
						<tr>
							<td>
								&nbsp;
							</td>
							<td align="center">
								<input type="button" value="DOWN" style="width: 240px;" onclick="shiftX(1);" />
							</td>
							<td>
								&nbsp;
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					&nbsp;
				</td>
				<td>
					Algorithm 2 (4386e503):
					<br />
					<div class="unscrambledImage" >
						<div class="tile00"><img id="image2x00" /></div>
						<div class="tile01"><img id="image2x01" /></div>
						<div class="tile02"><img id="image2x02" /></div>
						<div class="tile03"><img id="image2x03" /></div>

						<div class="tile10"><img id="image2x10" /></div>
						<div class="tile11"><img id="image2x11" /></div>
						<div class="tile12"><img id="image2x12" /></div>
						<div class="tile13"><img id="image2x13" /></div>
						
						<div class="tile20"><img id="image2x20" /></div>
						<div class="tile21"><img id="image2x21" /></div>
						<div class="tile22"><img id="image2x22" /></div>
						<div class="tile23"><img id="image2x23" /></div>
						
						<div class="tile30"><img id="image2x30" /></div>
						<div class="tile31"><img id="image2x31" /></div>
						<div class="tile32"><img id="image2x32" /></div>
						<div class="tile33"><img id="image2x33" /></div>
					</div>
				</td>
				<td>
					Algorithm 3 (267fa31a):
					<br />
					<div class="unscrambledImage" >
						<div class="tile00"><img id="image3x00" /></div>
						<div class="tile01"><img id="image3x01" /></div>
						<div class="tile02"><img id="image3x02" /></div>
						<div class="tile03"><img id="image3x03" /></div>

						<div class="tile10"><img id="image3x10" /></div>
						<div class="tile11"><img id="image3x11" /></div>
						<div class="tile12"><img id="image3x12" /></div>
						<div class="tile13"><img id="image3x13" /></div>
						
						<div class="tile20"><img id="image3x20" /></div>
						<div class="tile21"><img id="image3x21" /></div>
						<div class="tile22"><img id="image3x22" /></div>
						<div class="tile23"><img id="image3x23" /></div>
						
						<div class="tile30"><img id="image3x30" /></div>
						<div class="tile31"><img id="image3x31" /></div>
						<div class="tile32"><img id="image3x32" /></div>
						<div class="tile33"><img id="image3x33" /></div>
					</div>
				</td>
				<td>
					&nbsp;
				</td>
			</tr>
		</table>
	</body>
</html>
